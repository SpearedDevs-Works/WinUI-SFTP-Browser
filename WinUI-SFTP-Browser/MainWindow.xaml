<Window
    x:Class="WinUI_SFTP_Browser.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <Grid x:Name="AppTitleBar" Grid.Row="0" Height="48" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <Image Source="Assets/AppIcon.png" Width="16" Height="16" Margin="16,0,12,0" VerticalAlignment="Center"/>
            <TextBlock Grid.Column="1" Text="SFTP Browser" VerticalAlignment="Center" Style="{StaticResource CaptionTextBlockStyle}"/>
        </Grid>

        <!-- Menu Bar -->
        <CommandBar Grid.Row="1" DefaultLabelPosition="Right" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <AppBarButton Icon="Add" Label="New Connection" Click="NewConnection_Click"/>
            <AppBarButton Icon="Refresh" Label="Refresh" Click="Refresh_Click"/>
            <AppBarSeparator/>
            <AppBarButton Icon="Upload" Label="Upload" Click="Upload_Click" IsEnabled="{x:Bind ViewModel.IsConnected, Mode=OneWay}"/>
            <AppBarButton Icon="Download" Label="Download" Click="Download_Click" IsEnabled="{x:Bind ViewModel.HasSelection, Mode=OneWay}"/>
            <AppBarButton Icon="Delete" Label="Delete" Click="Delete_Click" IsEnabled="{x:Bind ViewModel.HasSelection, Mode=OneWay}"/>
            <AppBarSeparator/>
            <AppBarButton Icon="NewFolder" Label="New Folder" Click="NewFolder_Click" IsEnabled="{x:Bind ViewModel.IsConnected, Mode=OneWay}"/>
            <AppBarButton Icon="Sync" Label="Sync" Click="Sync_Click" IsEnabled="{x:Bind ViewModel.IsConnected, Mode=OneWay}"/>
        </CommandBar>

        <!-- Address Bar -->
        <Grid Grid.Row="2" Padding="12,8" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <Button Grid.Column="0" Click="Back_Click" IsEnabled="{x:Bind ViewModel.CanGoBack, Mode=OneWay}" Margin="0,0,4,0">
                <FontIcon Glyph="&#xE72B;" FontSize="12"/>
            </Button>
            <Button Grid.Column="1" Click="Forward_Click" IsEnabled="{x:Bind ViewModel.CanGoForward, Mode=OneWay}" Margin="0,0,8,0">
                <FontIcon Glyph="&#xE72A;" FontSize="12"/>
            </Button>
            <TextBox Grid.Column="2" x:Name="AddressBar" Text="{x:Bind ViewModel.CurrentPath, Mode=OneWay}" 
                     IsReadOnly="False" PlaceholderText="Connect to an SFTP server..." Margin="0,0,8,0"/>
            <Button Grid.Column="3" Content="Connect" Click="Connect_Click"/>
        </Grid>

        <!-- Main Content Area -->
        <Grid Grid.Row="3" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Column Headers -->
            <Border Grid.Row="0" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,0,0,1" Padding="12,8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="40"/>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="1*"/>
                        <ColumnDefinition Width="1*"/>
                        <ColumnDefinition Width="1*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="1" Text="Name" FontWeight="SemiBold"/>
                    <TextBlock Grid.Column="2" Text="Date Modified" FontWeight="SemiBold"/>
                    <TextBlock Grid.Column="3" Text="Type" FontWeight="SemiBold"/>
                    <TextBlock Grid.Column="4" Text="Size" FontWeight="SemiBold"/>
                </Grid>
            </Border>

            <!-- File List -->
            <ListView Grid.Row="1" x:Name="FileListView" 
                      ItemsSource="{x:Bind ViewModel.Items, Mode=OneWay}"
                      SelectionMode="Extended"
                      SelectionChanged="FileListView_SelectionChanged"
                      DoubleTapped="FileListView_DoubleTapped"
                      RightTapped="FileListView_RightTapped"
                      CanDragItems="True"
                      AllowDrop="True">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="local:FileItemViewModel">
                        <Grid Padding="4" Height="40">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="40"/>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="1*"/>
                                <ColumnDefinition Width="1*"/>
                                <ColumnDefinition Width="1*"/>
                            </Grid.ColumnDefinitions>
                            
                            <FontIcon Grid.Column="0" Glyph="{x:Bind Icon}" FontSize="16" Margin="8,0"/>
                            <TextBlock Grid.Column="1" Text="{x:Bind Name}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                            <TextBlock Grid.Column="2" Text="{x:Bind DateModified}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock Grid.Column="3" Text="{x:Bind Type}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock Grid.Column="4" Text="{x:Bind Size}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <!-- Empty State -->
            <StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center"
                        Visibility="{x:Bind ViewModel.ShowEmptyState, Mode=OneWay}">
                <FontIcon Glyph="&#xE753;" FontSize="64" Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                <TextBlock Text="No connection" FontSize="20" Margin="0,16,0,8" HorizontalAlignment="Center"/>
                <TextBlock Text="Connect to an SFTP server to browse files" 
                          Foreground="{ThemeResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
            </StackPanel>

            <!-- Loading Indicator -->
            <ProgressRing Grid.Row="1" IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}" 
                         Width="50" Height="50" VerticalAlignment="Center" HorizontalAlignment="Center"/>
        </Grid>

        <!-- Status Bar -->
        <Grid Grid.Row="4" Height="32" Background="{ThemeResource LayerFillColorDefaultBrush}" 
              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,1,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0" Text="{x:Bind ViewModel.StatusText, Mode=OneWay}" 
                       VerticalAlignment="Center" Margin="12,0" FontSize="12"/>
            <TextBlock Grid.Column="1" Text="{x:Bind ViewModel.ConnectionStatus, Mode=OneWay}" 
                       VerticalAlignment="Center" Margin="12,0" FontSize="12"/>
        </Grid>

        <!-- Context Menu -->
        <Grid.Resources>
            <MenuFlyout x:Key="FileContextMenu">
                <MenuFlyoutItem Text="Download" Icon="Download" Click="DownloadContextMenu_Click"/>
                <MenuFlyoutItem Text="Delete" Click="DeleteContextMenu_Click">
                    <MenuFlyoutItem.Icon>
                        <FontIcon Glyph="&#xE74D;"/>
                    </MenuFlyoutItem.Icon>
                </MenuFlyoutItem>
                <MenuFlyoutItem Text="Rename" Click="RenameContextMenu_Click">
                    <MenuFlyoutItem.Icon>
                        <FontIcon Glyph="&#xE8AC;"/>
                    </MenuFlyoutItem.Icon>
                </MenuFlyoutItem>
                <MenuFlyoutSeparator/>
                <MenuFlyoutItem Text="Properties" Click="PropertiesContextMenu_Click">
                    <MenuFlyoutItem.Icon>
                        <FontIcon Glyph="&#xE946;"/>
                    </MenuFlyoutItem.Icon>
                </MenuFlyoutItem>
            </MenuFlyout>
        </Grid.Resources>
    </Grid>
</Window>
