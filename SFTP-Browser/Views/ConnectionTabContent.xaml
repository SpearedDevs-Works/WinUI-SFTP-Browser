<UserControl
    x:Class="SFTP_Browser.Views.ConnectionTabContent"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:SFTP_Browser.ViewModels"
    mc:Ignorable="d">

    <UserControl.Resources>
        <MenuFlyout x:Key="FileContextMenu">
            <MenuFlyoutItem Text="Download" Icon="Download" Click="DownloadContextMenu_Click"/>
            <MenuFlyoutItem Text="Open" Click="OpenContextMenu_Click">
                <MenuFlyoutItem.Icon>
                    <FontIcon Glyph="&#xE8E5;"/>
                </MenuFlyoutItem.Icon>
            </MenuFlyoutItem>
            <MenuFlyoutItem Text="Delete" Click="DeleteContextMenu_Click">
                <MenuFlyoutItem.Icon>
                    <FontIcon Glyph="&#xE74D;"/>
                </MenuFlyoutItem.Icon>
            </MenuFlyoutItem>
            <MenuFlyoutItem Text="Rename" Click="RenameContextMenu_Click">
                <MenuFlyoutItem.Icon>
                    <FontIcon Glyph="&#xE8AC;"/>
                </MenuFlyoutItem.Icon>
            </MenuFlyoutItem>
            <MenuFlyoutSeparator/>
            <MenuFlyoutItem Text="Properties" Click="PropertiesContextMenu_Click">
                <MenuFlyoutItem.Icon>
                    <FontIcon Glyph="&#xE946;"/>
                </MenuFlyoutItem.Icon>
            </MenuFlyoutItem>
        </MenuFlyout>
    </UserControl.Resources>

    <Grid VerticalAlignment="Stretch">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <CommandBar Grid.Row="0" DefaultLabelPosition="Right" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <AppBarButton Icon="Add" Label="New Connection" Click="NewConnection_Click"/>
            <AppBarSeparator/>
            <AppBarButton Icon="Favorite" Label="Bookmarks" Click="Bookmarks_Click" />
            <AppBarSeparator/>
            <AppBarButton Icon="Refresh" Label="Refresh" Click="Refresh_Click" IsEnabled="{Binding IsConnected}"/>
            <AppBarSeparator/>
            <AppBarButton Icon="Upload" Label="Upload" Click="Upload_Click" IsEnabled="{Binding IsConnected}"/>
            <AppBarButton Icon="Download" Label="Download" Click="Download_Click" IsEnabled="{Binding HasSelection}"/>
            <AppBarButton Icon="Delete" Label="Delete" Click="Delete_Click" IsEnabled="{Binding HasSelection}"/>
            <AppBarSeparator/>
            <AppBarButton Icon="NewFolder" Label="New Folder" Click="NewFolder_Click" IsEnabled="{Binding IsConnected}"/>
            <AppBarButton Icon="Sync" Label="Sync" Click="Sync_Click" IsEnabled="{Binding IsConnected}"/>
        </CommandBar>

        <Grid Grid.Row="1" Padding="12,8" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" Click="Back_Click" IsEnabled="{Binding CanGoBack}" Margin="0,0,4,0">
                <FontIcon Glyph="&#xE72B;" FontSize="12"/>
            </Button>
            <Button Grid.Column="1" Click="Forward_Click" IsEnabled="{Binding CanGoForward}" Margin="0,0,8,0">
                <FontIcon Glyph="&#xE72A;" FontSize="12"/>
            </Button>
            <TextBox Grid.Column="2" Text="{Binding CurrentPath}" IsReadOnly="True" Margin="0,0,8,0"/>

            <TextBox Grid.Column="3" Width="220" Margin="0,0,8,0"
                     PlaceholderText="Search"
                     Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

            <ComboBox Grid.Column="4" Width="160" Margin="0,0,8,0"
                      SelectedValuePath="Content"
                      SelectedValue="{Binding SortMode, Mode=TwoWay}">
                <ComboBoxItem Content="Name" />
                <ComboBoxItem Content="Date Modified" />
                <ComboBoxItem Content="Type" />
                <ComboBoxItem Content="Size" />
            </ComboBox>

            <ToggleButton Grid.Column="5" Width="44" Margin="0,0,8,0"
                          IsChecked="{Binding SortDescending, Mode=TwoWay}"
                          ToolTipService.ToolTip="Sort descending">
                <FontIcon Glyph="&#xE74B;" />
            </ToggleButton>

            <Button Grid.Column="6" Content="Disconnect" Click="Disconnect_Click" IsEnabled="{Binding IsConnected}"/>
        </Grid>

        <Border Grid.Row="2" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,0,0,1" Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="40"/>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="1*"/>
                    <ColumnDefinition Width="1*"/>
                    <ColumnDefinition Width="1*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="1" Text="Name" FontWeight="SemiBold"/>
                <TextBlock Grid.Column="2" Text="Date Modified" FontWeight="SemiBold"/>
                <TextBlock Grid.Column="3" Text="Type" FontWeight="SemiBold"/>
                <TextBlock Grid.Column="4" Text="Size" FontWeight="SemiBold"/>
            </Grid>
        </Border>

        <Grid Grid.Row="3" Background="{ThemeResource LayerFillColorDefaultBrush}" VerticalAlignment="Stretch">
            <ListView x:Name="FileListView"
                      ItemsSource="{Binding Items}"
                      SelectionMode="Extended"
                      SelectionChanged="FileListView_SelectionChanged"
                      DoubleTapped="FileListView_DoubleTapped"
                      RightTapped="FileListView_RightTapped"
                      AllowDrop="True"
                      DragOver="FileListView_DragOver"
                      Drop="FileListView_Drop"
                      VerticalAlignment="Stretch"
                      VerticalContentAlignment="Stretch">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="vm:FileItemViewModel">
                        <Grid Padding="4" Height="40">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="40"/>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="1*"/>
                                <ColumnDefinition Width="1*"/>
                                <ColumnDefinition Width="1*"/>
                            </Grid.ColumnDefinitions>

                            <FontIcon Grid.Column="0" Glyph="{x:Bind Icon}" FontSize="16" Margin="8,0"/>
                            <TextBlock Grid.Column="1" Text="{x:Bind Name}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                            <TextBlock Grid.Column="2" Text="{x:Bind DateModified}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock Grid.Column="3" Text="{x:Bind Type}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock Grid.Column="4" Text="{x:Bind Size}" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Visibility="{Binding ShowEmptyState}">
                <FontIcon Glyph="&#xE753;" FontSize="64" Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                <TextBlock Text="No connection" FontSize="20" Margin="0,16,0,8" HorizontalAlignment="Center"/>
                <TextBlock Text="Connect to an SFTP server to browse files"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
            </StackPanel>

            <ProgressRing IsActive="{Binding IsLoading}" Width="50" Height="50" VerticalAlignment="Center" HorizontalAlignment="Center" />
        </Grid>

        <Border Grid.Row="4" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,1,0,1" Background="{ThemeResource LayerFillColorDefaultBrush}" Padding="12,6">
            <StackPanel>
                <TextBlock Text="Transfers" FontWeight="SemiBold" Margin="0,0,0,6" />
                <ListView ItemsSource="{Binding Transfers}" MaxHeight="160">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="vm:TransferItemViewModel">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="{x:Bind DisplayName}" />
                                    <TextBlock Text="{x:Bind StatusText, Mode=OneWay}" Opacity="0.7" FontSize="12" />
                                </StackPanel>
                                <ProgressBar Grid.Column="1" Width="120" Height="6" Margin="12,0,0,0" Value="{x:Bind Progress, Mode=OneWay}" Maximum="1" />
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </StackPanel>
        </Border>

        <Grid Grid.Row="5" Height="32" Background="{ThemeResource LayerFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,1,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Text="{Binding StatusText}" VerticalAlignment="Center" Margin="12,0" FontSize="12"/>
            <TextBlock Grid.Column="1" Text="{Binding ConnectionStatus}" VerticalAlignment="Center" Margin="12,0" FontSize="12"/>
        </Grid>

    </Grid>
</UserControl>